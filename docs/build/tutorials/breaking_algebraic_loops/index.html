<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Breaking Algebraic Loops · Jusdl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Jusdl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Jusdl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Modeling and Simulation in Jusdl</span><ul><li><a class="tocitem" href="../../modeling_and_simulation/modeling/">Modelling</a></li><li><a class="tocitem" href="../../modeling_and_simulation/simulation/">Simulation</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/utilities/callback/">Callback</a></li><li><a class="tocitem" href="../../manual/utilities/buffers/">Buffer</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Connections</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/connections/link/">Links</a></li><li><a class="tocitem" href="../../manual/connections/bus/">Busses</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Components</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-3-1"><span class="docs-label">ComponentsBase</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/components/componentsbase/evolution/">Evolution of Components</a></li><li><a class="tocitem" href="../../manual/components/componentsbase/generic_fields/">Generic Fields of Components</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-3-2"><span class="docs-label">Sources</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/components/sources/clock/">Clock</a></li><li><a class="tocitem" href="../../manual/components/sources/generators/">Generators</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3-3"><span class="docs-label">Sinks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/components/sinks/sinks/">Sinks</a></li><li><a class="tocitem" href="../../manual/components/sinks/writer/">Writer</a></li><li><a class="tocitem" href="../../manual/components/sinks/printer/">Printer</a></li><li><a class="tocitem" href="../../manual/components/sinks/scope/">Scope</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-3-4"><span class="docs-label">Systems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-3-4-1" type="checkbox"/><label class="tocitem" for="menuitem-3-3-4-1"><span class="docs-label">StaticSystems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/components/systems/staticsystems/staticsystems/">StaticSystems</a></li><li><a class="tocitem" href="../../manual/components/systems/staticsystems/subsystem/">Subsystem</a></li><li><a class="tocitem" href="../../manual/components/systems/staticsystems/network/">Network</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3-4-2" type="checkbox"/><label class="tocitem" for="menuitem-3-3-4-2"><span class="docs-label">DynamicSystems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/components/systems/dynamicsystems/discretesystem/">DiscreteSystem</a></li><li><a class="tocitem" href="../../manual/components/systems/dynamicsystems/odesystem/">ODESystem</a></li><li><a class="tocitem" href="../../manual/components/systems/dynamicsystems/daesystem/">DAESystem</a></li><li><a class="tocitem" href="../../manual/components/systems/dynamicsystems/rodesystem/">RODESystem</a></li><li><a class="tocitem" href="../../manual/components/systems/dynamicsystems/sdesystem/">SDESystem</a></li><li><a class="tocitem" href="../../manual/components/systems/dynamicsystems/ddesystem/">DDESystem</a></li></ul></li></ul></li></ul></li><li><a class="tocitem" href="../../manual/plugins/plugins/">Plugins</a></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/models/taskmanager/">Task Manager</a></li><li><a class="tocitem" href="../../manual/models/simulation/">Simulation</a></li><li><a class="tocitem" href="../../manual/models/model/">Model</a></li></ul></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../simple_model/">Simple Model Simulation</a></li><li class="is-active"><a class="tocitem" href>Breaking Algebraic Loops</a></li><li><a class="tocitem" href="../construction_and_simulation_of_subsystems/">Constuction and Simulation of Subsystems</a></li><li><a class="tocitem" href="../construction_and_simulation_of_networks/">Constuction and Simulation of Networks</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Breaking Algebraic Loops</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Breaking Algebraic Loops</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/zekeriyasari/Jusdl.jl/blob/master/docs/src/tutorials/breaking_algebraic_loops.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Breaking-Algebraic-Loops-1"><a class="docs-heading-anchor" href="#Breaking-Algebraic-Loops-1">Breaking Algebraic Loops</a><a class="docs-heading-anchor-permalink" href="#Breaking-Algebraic-Loops-1" title="Permalink"></a></h1><p>It this tutorial, we will simulate model consisting a closed loop feedback system. The model has an algebraic loop. </p><h3 id="Algebraic-Loops-1"><a class="docs-heading-anchor" href="#Algebraic-Loops-1">Algebraic Loops</a><a class="docs-heading-anchor-permalink" href="#Algebraic-Loops-1" title="Permalink"></a></h3><p>In a clocked simulation environment such as <code>Jusdl</code>, algebraic loops are problematic. This is because, at any instant of time, the components in the model are evolved. During this evolution, components read their inputs. If data is not available in their input busses, the components wait until data is available in their input busses. If the model has an algebraic loop, all the components in the algebraic loop wait for other components to produce data and drive them. However, since the components in the algebraic loop are feed-through loops, i.e. the outputs of the components depend directly on its inputs, a wait loop occurs. This wait-loop makes the simulation of the model get stuck. A system whose model includes algebraic loops can be simulated, though. One way is to remodel the system so that the model has no algebraic loops anymore. This can be done by explicitly solving algebraic equations of algebraic loops. Or, a <a href="tutorials/ref"><code>Memory</code></a> component can be added anywhere in the algebraic loop. The drawback of using a memory component is that the initial condition of the memory should be compatible with the model. </p><h3 id="Simulation-When-Memory-is-Initialized-Correctly-1"><a class="docs-heading-anchor" href="#Simulation-When-Memory-is-Initialized-Correctly-1">Simulation When Memory is Initialized Correctly</a><a class="docs-heading-anchor-permalink" href="#Simulation-When-Memory-is-Initialized-Correctly-1" title="Permalink"></a></h3><p>The original model consists of a generator and an adder. So, we start with these components </p><pre><code class="language-julia">gen = FunctionGenerator(identity)
adder = Adder(Bus(2), (+, -))</code></pre><pre><code class="language-none">Adder(signs:(+, -), input:Bus(nlinks:2, eltype:Link{Float64}, isreadable:false, iswritable:false), output:Bus(nlinks:1, eltype:Link{Float64}, isreadable:false, iswritable:false))</code></pre><p>To break the algebraic loop, we construct a memory.</p><pre><code class="language-julia">mem = Memory(Bus(1), 1, initial=0.)</code></pre><pre><code class="language-none">Memory(ndelay:1, input:Bus(nlinks:1, eltype:Link{Float64}, isreadable:false, iswritable:false), output:Bus(nlinks:1, eltype:Link{Float64}, isreadable:false, iswritable:false))</code></pre><p>For data recording, we construct writers.</p><pre><code class="language-julia">writerout = Writer(Bus(length(adder.output)))
writerin = Writer(Bus(length(gen.output)))</code></pre><pre><code class="language-none">Writer(path:/tmp/e35a2490-2672-44ea-803a-ce78ecd78c54.jld2, nin:1)</code></pre><p>The next step is to connect the components. Note that we placed the memory on the feedback path from the output of adder to its second link of its input bus. </p><pre><code class="language-julia">connect(gen.output, adder.input[1])
connect(mem.output, adder.input[2])
connect(adder.output, mem.input)
connect(mem.output, writerout.input)
connect(gen.output, writerin.input)</code></pre><p>Now we are ready to construct and simulate the model.</p><pre><code class="language-julia">t0, dt, tf = 0, 1 / 64, 1.
model = Model(gen, adder, mem, writerout, writerin)
sim = simulate(model, t0, dt, tf)</code></pre><pre><code class="language-none">Simulation(state:done, retcode:success, path:/tmp/Simulation-40ecef43-6ae2-4d37-aae1-52a31976232c)</code></pre><p>After the simulation, let us check whether the tasks are terminated securely.</p><pre><code class="language-julia">model.taskmanager.pairs</code></pre><pre><code class="language-none">Dict{Any,Any} with 5 entries:
  FunctionGenerator(output… =&gt; ComponentTask{Task,Task}(Task (done) @0x00007f74…
  Memory(ndelay:1, input:B… =&gt; ComponentTask{Task,Task}(Task (done) @0x00007f74…
  Adder(signs:(+, -), inpu… =&gt; ComponentTask{Task,Task}(Task (done) @0x00007f74…
  Writer(path:/tmp/Simulat… =&gt; ComponentTask{Task,Nothing}(Task (done) @0x00007…
  Writer(path:/tmp/Simulat… =&gt; ComponentTask{Task,Nothing}(Task (done) @0x00007…</code></pre><p>Next, we read the data from the writers and plot them,</p><pre><code class="language-julia">using Plots
t, y = read(writerout, flatten=true)
t, u = read(writerin, flatten=true)
plot(t, u, label=:u, marker=(:circle, 1))
plot!(t, y, label=:y, marker=(:circle, 1))</code></pre><pre><code class="language-none">qt5ct: using qt5ct plugin</code></pre><p><img src="../breaking_algebraic_loops_plot1.svg" alt/></p><h3 id="Simulation-When-Memory-is-Initialized-Incorrectly-1"><a class="docs-heading-anchor" href="#Simulation-When-Memory-is-Initialized-Incorrectly-1">Simulation When Memory is Initialized Incorrectly</a><a class="docs-heading-anchor-permalink" href="#Simulation-When-Memory-is-Initialized-Incorrectly-1" title="Permalink"></a></h3><p>We know that when the relation is </p><div>\[y(t) = \dfrac{u(t)}{2}\]</div><p>where <span>$u(t)$</span> is the input and <span>$y(t)$</span> is the output. Thus for <span>$u(t) = t$</span>, <span>$y(0) = u(0) / 2  = 0$</span>. This implies, the initial condition of the memory is <span>$0$</span>. If the initial condition of the memory is different, then oscillations in the output of the memory occurs which lead inaccurate results. See the full script below. </p><pre><code class="language-julia">using Jusdl
using Plots

# Simualation settings
t0, dt, tf = 0, 1 / 64, 1.

# Construct model blocks
gen = FunctionGenerator(identity)
adder = Adder(Bus(2), (+, -))
mem = Memory(Bus(1), 1, initial=0.5)    # Initial condition is very important for accurate solutions.
writerout = Writer(Bus(length(adder.output)))
writerin = Writer(Bus(length(gen.output)))

# Connect model blocks
connect(gen.output, adder.input[1])
connect(mem.output, adder.input[2])
connect(adder.output, mem.input)
connect(mem.output, writerout.input)
connect(gen.output, writerin.input)

# Construct the model
model = Model(gen, adder, mem, writerout, writerin)

# Simulate the model
sim = simulate(model, t0, dt, tf)

# Display model taskmanager
display(model.taskmanager.pairs)

# Read the simulation data
t, y = read(writerout, flatten=true)
t, u = read(writerin, flatten=true)

# Plot the results
plot(t, u, label=:u, marker=(:circle, 1))
plot!(t, y, label=:y, marker=(:circle, 1))</code></pre><pre><code class="language-none">[ Info: 2020-02-23T02:20:30.045 Started simulation...
[ Info: 2020-02-23T02:20:30.045 Inspecting model...
[ Info: 2020-02-23T02:20:30.045 Done.
[ Info: 2020-02-23T02:20:30.045 Initializing the model...
[ Info: 2020-02-23T02:20:30.045 Done...
[ Info: 2020-02-23T02:20:30.045 Running the simulation...
[ Info: 2020-02-23T02:20:30.049 Done...
[ Info: 2020-02-23T02:20:30.049 Releasing model components...
[ Info: 2020-02-23T02:20:30.049 Done.
[ Info: 2020-02-23T02:20:30.049 Terminating the simulation...
[ Info: 2020-02-23T02:20:30.068 Done.
qt5ct: using qt5ct plugin</code></pre><p><img src="../breaking_algebraic_loops_plot2.svg" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../simple_model/">« Simple Model Simulation</a><a class="docs-footer-nextpage" href="../construction_and_simulation_of_subsystems/">Constuction and Simulation of Subsystems »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 23 February 2020 02:20">Sunday 23 February 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
