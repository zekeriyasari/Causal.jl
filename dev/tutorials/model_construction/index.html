<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Model Construction · Causal</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Causal</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Modeling and Simulation in Causal</span><ul><li><a class="tocitem" href="../../modeling_and_simulation/modeling/">Modeling</a></li><li><a class="tocitem" href="../../modeling_and_simulation/simulation/">Simulation</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li class="is-active"><a class="tocitem" href>Model Construction</a><ul class="internal"><li><a class="tocitem" href="#section_header"><span>Modifying Models</span></a></li><li><a class="tocitem" href="#Describing-Models"><span>Describing Models</span></a></li><li><a class="tocitem" href="#Usage-of-Signal-Flow-Graph"><span>Usage of Signal-Flow Graph</span></a></li></ul></li><li><a class="tocitem" href="../model_simulation/">Model Simulation</a></li><li><a class="tocitem" href="../algebraic_loops/">Algebraic Loops</a></li><li><a class="tocitem" href="../defining_new_components/">Extending Component Library</a></li><li><a class="tocitem" href="../coupled_systems/">Coupled Systems</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/utilities/callback/">Callback</a></li><li><a class="tocitem" href="../../manual/utilities/buffers/">Buffer</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Connections</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/connections/link/">Links</a></li><li><a class="tocitem" href="../../manual/connections/pin/">Pins</a></li><li><a class="tocitem" href="../../manual/connections/port/">Ports</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Components</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-3-1" type="checkbox"/><label class="tocitem" for="menuitem-4-3-1"><span class="docs-label">ComponentsBase</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/components/componentsbase/hierarchy/">Component Type Hierarchy</a></li><li><a class="tocitem" href="../../manual/components/componentsbase/evolution/">Evolution of Components</a></li><li><a class="tocitem" href="../../manual/components/componentsbase/interpolation/">Interpolation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3-2" type="checkbox"/><label class="tocitem" for="menuitem-4-3-2"><span class="docs-label">Sources</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/components/sources/clock/">Clock</a></li><li><a class="tocitem" href="../../manual/components/sources/generators/">Generators</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3-3"><span class="docs-label">Sinks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/components/sinks/sinks/">Sinks</a></li><li><a class="tocitem" href="../../manual/components/sinks/writer/">Writer</a></li><li><a class="tocitem" href="../../manual/components/sinks/printer/">Printer</a></li><li><a class="tocitem" href="../../manual/components/sinks/scope/">Scope</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3-4" type="checkbox"/><label class="tocitem" for="menuitem-4-3-4"><span class="docs-label">Systems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-3-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-3-4-1"><span class="docs-label">StaticSystems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/components/systems/staticsystems/staticsystems/">StaticSystems</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-3-4-2"><span class="docs-label">DynamicSystems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/components/systems/dynamicsystems/discretesystem/">DiscreteSystem</a></li><li><a class="tocitem" href="../../manual/components/systems/dynamicsystems/odesystem/">ODESystem</a></li><li><a class="tocitem" href="../../manual/components/systems/dynamicsystems/daesystem/">DAESystem</a></li><li><a class="tocitem" href="../../manual/components/systems/dynamicsystems/rodesystem/">RODESystem</a></li><li><a class="tocitem" href="../../manual/components/systems/dynamicsystems/sdesystem/">SDESystem</a></li><li><a class="tocitem" href="../../manual/components/systems/dynamicsystems/ddesystem/">DDESystem</a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/models/taskmanager/">Task Manager</a></li><li><a class="tocitem" href="../../manual/models/simulation/">Simulation</a></li><li><a class="tocitem" href="../../manual/models/model/">Model</a></li></ul></li><li><a class="tocitem" href="../../manual/plugins/plugins/">Plugins</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Model Construction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Model Construction</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/zekeriyasari/Causal.jl/blob/master/docs/src/tutorials/model_construction.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="page_header"><a class="docs-heading-anchor" href="#page_header">Model Construction</a><a id="page_header-1"></a><a class="docs-heading-anchor-permalink" href="#page_header" title="Permalink"></a></h1><p>This tutorial illustrates model construction and  the relation between models and graphs. A model consists of components and connections. These components and connections can be associated with a signal-flow graph signifying the topology of the model. In the realm of graph theory, components and connections of a model are associated with nodes and branches of the signal-flow graph. As the model is modified by adding or deleting components or connections, the signal-flow graph of the model is modified accordingly to keep track of topological modifications. By associating a signal-flow graph to a model, any graph-theoretical analysis can be performed. An example to such an analysis is the determination and braking of algebraic loops. </p><p>In Causal, a model can be constructed either by describing it in one-shot or by gradually modifying it by adding new nodes and branches. To show the relation between models and graphs, we start with the latter.</p><h2 id="section_header"><a class="docs-heading-anchor" href="#section_header">Modifying Models</a><a id="section_header-1"></a><a class="docs-heading-anchor-permalink" href="#section_header" title="Permalink"></a></h2><p>In this tutorial, we construct the model with the following block diagram</p><center>
    <img src="../../assets/SimpleModel/simplemodel.svg" alt="model" width="60%"/>
</center><p>and with the following signal-flow graph </p><center>
    <img src="../../assets/SignalFlow/signalflow.svg" alt="model" width="50%"/>
</center><p>Let&#39;s start with an empty <a href="../../manual/models/model/#Causal.Model"><code>Model</code></a>.</p><pre><code class="language-julia-repl">julia&gt; using Causal # hide

julia&gt; model = Model()
Model(numnodes:0, numedges:0, timesettings=(0.0, 0.01, 1.0))</code></pre><p>We constructed an empty model, i.e., the model has no components and connections. To modify the model, we need to add components and connections to the model. As the model is grown by adding components and connections, the components and connections are added into the model as nodes and branches (see <a href="../../manual/models/model/#Causal.Node"><code>Node</code></a>, <a href="../../manual/models/model/#Causal.Branch"><code>Branch</code></a>).  Let&#39;s add our first component, a <a href="../../manual/components/sources/generators/#Causal.SinewaveGenerator"><code>SinewaveGenerator</code></a> to the <code>model</code>.</p><pre><code class="language-julia-repl">julia&gt; addnode!(model, SinewaveGenerator(), label=:gen)
Node(component:SinewaveGenerator(amp:1.0, freq:1.0, phase:0.0, offset:0.0, delay:0.0), idx:1, label:gen)</code></pre><p>To add components to the <code>model</code>, we use <a href="../../manual/models/model/#Causal.addnode!-Tuple{Model,AbstractComponent}"><code>addnode!</code></a> function. As seen, our node consists of a component, an index, and a label. </p><pre><code class="language-julia-repl">julia&gt; node1 = model.nodes[1]
Node(component:SinewaveGenerator(amp:1.0, freq:1.0, phase:0.0, offset:0.0, delay:0.0), idx:1, label:gen)

julia&gt; node1.component
SinewaveGenerator(amp:1.0, freq:1.0, phase:0.0, offset:0.0, delay:0.0)

julia&gt; node1.idx
1

julia&gt; node1.label
:gen</code></pre><p>Let us add another component, a <a href="../../manual/components/systems/staticsystems/staticsystems/#Causal.Adder"><code>Adder</code></a>, to the model, </p><pre><code class="language-julia-repl">julia&gt; addnode!(model, Adder(signs=(+,-)), label=:adder)
Node(component:Adder(signs:(+, -), input:Inport(numpins:2, eltype:Inpin{Float64}), output:Outport(numpins:1, eltype:Outpin{Float64})), idx:2, label:adder)</code></pre><p>and investigate our new node.</p><pre><code class="language-julia-repl">julia&gt; node2 = model.nodes[2]
Node(component:Adder(signs:(+, -), input:Inport(numpins:2, eltype:Inpin{Float64}), output:Outport(numpins:1, eltype:Outpin{Float64})), idx:2, label:adder)

julia&gt; node2.component
Adder(signs:(+, -), input:Inport(numpins:2, eltype:Inpin{Float64}), output:Outport(numpins:1, eltype:Outpin{Float64}))

julia&gt; node2.idx
2

julia&gt; node2.label
:adder</code></pre><p>Note that as new nodes are added to the <code>model</code>, they are given an index <code>idx</code> and a label <code>label</code>. The label is not mandatory, if not specified explicitly, <code>nothing</code> is assigned as label. The reason to add components as nodes is to access them through their node index <code>idx</code> or <code>labels</code>. For instance, we can access our first node by using its node index <code>idx</code> or node label <code>label</code>. </p><pre><code class="language-julia-repl">julia&gt; getnode(model, :gen)    # Access by label
Node(component:SinewaveGenerator(amp:1.0, freq:1.0, phase:0.0, offset:0.0, delay:0.0), idx:1, label:gen)

julia&gt; getnode(model, 1)       # Access by index
Node(component:SinewaveGenerator(amp:1.0, freq:1.0, phase:0.0, offset:0.0, delay:0.0), idx:1, label:gen)</code></pre><p>At this point, we have two nodes in our model. Let&#39;s add two more nodes, a <a href="../../manual/components/systems/staticsystems/staticsystems/#Causal.Gain"><code>Gain</code></a> and a <a href="../../manual/components/sinks/writer/#Causal.Writer"><code>Writer</code></a></p><pre><code class="language-julia-repl">julia&gt; addnode!(model, Gain(), label=:gain)
Node(component:Gain(gain:1.0, input:Inport(numpins:1, eltype:Inpin{Float64}), output:Outport(numpins:1, eltype:Outpin{Float64})), idx:3, label:gain)

julia&gt; addnode!(model, Writer(), label=:writer)
Node(component:Writer(path:/tmp/f97c6803-a377-4deb-9dba-a36a6c9748d2, nin:1), idx:4, label:writer)</code></pre><p>As the nodes are added to the <code>model</code>, its graph is modified accordingly.</p><pre><code class="language-julia-repl">julia&gt; model.graph
{4, 0} directed simple Int64 graph</code></pre><p><code>model</code> has no connections. Let&#39;s add our first connection by connecting the first pin of the output port of the node 1 (which is labelled as <code>:gen</code>) to the first input pin of input port of node 2 (which is labelled as <code>:adder</code>). </p><pre><code class="language-julia-repl">julia&gt; addbranch!(model, :gen =&gt; :adder, 1 =&gt; 1)
Branch(nodepair:1 =&gt; 2, indexpair:1 =&gt; 1, links:Link{Float64}[Link(state:open, eltype:Float64, isreadable:false, iswritable:false)])</code></pre><p>The node labelled with <code>:gen</code> has an output port having one pin, and the node labelled with <code>:adder</code> has an input port of two pins. In our first connection, we connected the first(and the only) pin of the output port of the node labelled with <code>:gen</code> to the first pin of the input port of the node labelled with <code>:adder</code>.  The connections are added to model as branches, </p><pre><code class="language-julia-repl">julia&gt; model.branches
1-element Array{Any,1}:
 Branch(nodepair:1 =&gt; 2, indexpair:1 =&gt; 1, links:Link{Float64}[Link(state:open, eltype:Float64, isreadable:false, iswritable:false)])</code></pre><p>A branch between any pair of nodes can be accessed through the indexes or labels of nodes. </p><pre><code class="language-julia-repl">julia&gt; br = getbranch(model, :gen =&gt; :adder)
Branch(nodepair:1 =&gt; 2, indexpair:1 =&gt; 1, links:Link{Float64}[Link(state:open, eltype:Float64, isreadable:false, iswritable:false)])

julia&gt; br.nodepair
1 =&gt; 2

julia&gt; br.indexpair
1 =&gt; 1

julia&gt; br.links
1-element Array{Link{Float64},1}:
 Link(state:open, eltype:Float64, isreadable:false, iswritable:false)</code></pre><p>Note the branch <code>br</code> has one link(see <a href="../../manual/connections/link/#Causal.Link"><code>Link</code></a>). This is because we connected one pin to another pin. The branch that connects <span>$n$</span> pins to each other has <code>n</code> links. Let us complete the construction of the model by adding other connections. </p><pre><code class="language-julia-repl">julia&gt; addbranch!(model, :adder =&gt; :gain, 1 =&gt; 1)
Branch(nodepair:2 =&gt; 3, indexpair:1 =&gt; 1, links:Link{Float64}[Link(state:open, eltype:Float64, isreadable:false, iswritable:false)])

julia&gt; addbranch!(model, :gain =&gt; :adder, 1 =&gt; 2)
Branch(nodepair:3 =&gt; 2, indexpair:1 =&gt; 2, links:Link{Float64}[Link(state:open, eltype:Float64, isreadable:false, iswritable:false)])

julia&gt; addbranch!(model, :gain =&gt; :writer, 1 =&gt; 1)
Branch(nodepair:3 =&gt; 4, indexpair:1 =&gt; 1, links:Link{Float64}[Link(state:open, eltype:Float64, isreadable:false, iswritable:false)])</code></pre><h2 id="Describing-Models"><a class="docs-heading-anchor" href="#Describing-Models">Describing Models</a><a id="Describing-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Describing-Models" title="Permalink"></a></h2><p>The second approach is to describe the whole model. In this approach the model is constructed in single-shot. The syntax here is </p><pre><code class="language-julia">@defmodel modelname begin 
    @nodes begin 
        label1 = Component1(args...; kwargs...)     # Node 1
        label2 = Component2(args...; kwargs...)     # Node 2
                ⋮                                       ⋮
        
        labelN = ComponentN(args...; kwargs...)     # Node N
    end 
    @branches begin 
        src_label1[src_index1] = dst_label1[dst_index1]     # Branch 1
        src_label2[src_index2] = dst_label1[dst_index2]     # Branch 2 
            ⋮                                                   ⋮
        src_labelM[src_indexM] = dst_labelM[dst_indexM]     # Branch M
    end
end </code></pre><p>Note that <code>modelname</code> is the name of the model to be compiled. The nodes of the model is defined in <code>@nodes begin ... end</code> block and the branches of the model is defined in <code>@branches begin ... end</code>. The syntax <code>src_label1[src_index1] = dst_label1[dst_index1]</code> means that there is a branch between the node labelled with <code>src_label1</code> and the node labelled with <code>dst_label1</code>.And, this branch connects the pins indexed by <code>src_index1</code> of the output port of <code>src_label1</code> to the pins indexed by <code>dst_index1</code> of the input port of <code>dst_label1</code>. The indexing of the pins here is just like any one dimensional array indexing. That is <code>src_index1</code>( or <code>dst_index1</code>) may be integer, vector of integers, vector of booleans, range, etc.</p><p>For example, the model given above can also be constructed as follows </p><pre><code class="language-julia-repl">julia&gt; using Causal # hide

julia&gt; @defmodel model begin
           @nodes begin
               gen = SinewaveGenerator()
               adder = Adder(signs=(+,-))
               gain = Gain()
               writer = Writer()
           end
           @branches begin
               gen[1]      =&gt;      adder[1]
               adder[1]    =&gt;      gain[1]
               gain[1]     =&gt;      adder[2]
               gain[1]     =&gt;      writer[1]
           end
       end</code></pre><p>This macro is expanded to construct the <code>model</code>.</p><h2 id="Usage-of-Signal-Flow-Graph"><a class="docs-heading-anchor" href="#Usage-of-Signal-Flow-Graph">Usage of Signal-Flow Graph</a><a id="Usage-of-Signal-Flow-Graph-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-of-Signal-Flow-Graph" title="Permalink"></a></h2><p>The signal-flow graph constructed alongside of the construction of the model can be used to perform any topological analysis. An example to such an analysis is the detection of algebraic loops. For instance, our model in this tutorial has an algebraic loop consisting of the nodes labelled with <code>:gen</code> and <code>gain</code>. This loop can be detected using the signal-flow graph of the node </p><pre><code class="language-julia-repl">julia&gt; loops = getloops(model)
1-element Array{Array{Int64,1},1}:
 [2, 3]</code></pre><p>We have one loop consisting the nodes with indexes 2 and 3. </p><p>For further analysis on model graph, we use <a href="https://juliagraphs.org/LightGraphs.jl/stable/"><code>LightGraphs</code></a> package.</p><pre><code class="language-julia-repl">julia&gt; using LightGraphs

julia&gt; graph = model.graph
{4, 4} directed simple Int64 graph</code></pre><p>For example, the adjacency matrix of model graph can be obtained. </p><pre><code class="language-julia-repl">julia&gt; adjacency_matrix(model.graph)
4×4 SparseArrays.SparseMatrixCSC{Int64,Int64} with 4 stored entries:
  [1, 2]  =  1
  [3, 2]  =  1
  [2, 3]  =  1
  [3, 4]  =  1</code></pre><p>or inneighbors or outneighbors of a node can be obtained.</p><pre><code class="language-julia-repl">julia&gt; inneighbors(model.graph, getnode(model, :adder).idx)
2-element Array{Int64,1}:
 1
 3

julia&gt; outneighbors(model.graph, getnode(model, :adder).idx)
1-element Array{Int64,1}:
 3</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../modeling_and_simulation/simulation/">« Simulation</a><a class="docs-footer-nextpage" href="../model_simulation/">Model Simulation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 24 August 2020 20:30">Monday 24 August 2020</span>. Using Julia version 1.5.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
